<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Thank You - Bear Intake Contract</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 20px;
        }
        .thank-you-container {
            background: white;
            border-radius: 15px;
            padding: 50px;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .checkmark {
            font-size: 80px;
            color: #4CAF50;
            margin-bottom: 20px;
        }
        p {
            color: #666;
            font-size: 18px;
            margin-bottom: 30px;
        }
        .download-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        .download-btn {
            padding: 15px 30px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
            min-width: 200px;
        }
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .btn-word {
            background: #2b579a;
            color: white;
        }
        .btn-pdf {
            background: #d9534f;
            color: white;
        }
        .btn-both {
            background: #5cb85c;
            color: white;
        }
        .loading {
            display: none;
            margin-top: 20px;
            color: #666;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="thank-you-container">
        <div class="checkmark">‚úì</div>
        <h1>Thank You!</h1>
        <p>Your Bear Intake Contract has been submitted successfully.</p>
        <p>Choose your preferred download format:</p>
        
        <div class="download-buttons">
            <button class="download-btn btn-word" onclick="downloadWord()">
                üìÑ Download Word (.docx)
            </button>
            <button class="download-btn btn-pdf" onclick="downloadPDF()">
                üìï Download PDF
            </button>
            <button class="download-btn btn-both" onclick="downloadBoth()">
                üì¶ Download Both
            </button>

            <div style="margin-top: 30px;">
    <button class="download-btn" style="background: #6c757d;" onclick="window.location.href='windowform.html'">
        üìù Submit Another Form
    </button>
</div>


        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Generating your documents...</p>
        </div>
    </div>

    <script>
        // Get form data from localStorage
        const formData = JSON.parse(localStorage.getItem('bearContractData'));

        if (!formData) {
            alert('No form data found. Redirecting back to form.');
            window.location.href = 'windowform.html';
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        async function downloadWord() {
    showLoading();
    try {
        const { Document, Packer, Paragraph, Table, TableRow, TableCell, WidthType, AlignmentType, HeadingLevel, TextRun, UnderlineType } = docx;

        const doc = new Document({
            sections: [{
                properties: {
                    page: {
                        margin: {
                            top: 720,
                            right: 720,
                            bottom: 720,
                            left: 720,
                        },
                    },
                },
                children: [
                    // Header/Title
                    new Paragraph({
                        text: "BEAR INTAKE CONTRACT",
                        heading: HeadingLevel.HEADING_1,
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 200 }
                    }),

                    // Contract Date
                    new Paragraph({
                        text: `Date: ${new Date().toLocaleDateString()}`,
                        alignment: AlignmentType.RIGHT,
                        spacing: { after: 300 }
                    }),

                    // Client Information Table
                    new Paragraph({
                        text: "CLIENT INFORMATION",
                        heading: HeadingLevel.HEADING_2,
                        spacing: { before: 200, after: 100 }
                    }),

                    new Table({
                        width: { size: 100, type: WidthType.PERCENTAGE },
                        rows: [
                            new TableRow({
                                children: [
                                    new TableCell({
                                        children: [new Paragraph({ text: "Sold To:", bold: true })],
                                        width: { size: 20, type: WidthType.PERCENTAGE },
                                        shading: { fill: "E7E6E6" }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph(formData.soldTo)],
                                        width: { size: 30, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Phone:", bold: true })],
                                        width: { size: 20, type: WidthType.PERCENTAGE },
                                        shading: { fill: "E7E6E6" }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph(formData.phone)],
                                        width: { size: 30, type: WidthType.PERCENTAGE }
                                    })
                                ]
                            }),
                            new TableRow({
                                children: [
                                    new TableCell({
                                        children: [new Paragraph({ text: "Email:", bold: true })],
                                        shading: { fill: "E7E6E6" }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph(formData.email)]
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Job Site:", bold: true })],
                                        shading: { fill: "E7E6E6" }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph(formData.jobSite)]
                                    })
                                ]
                            })
                        ]
                    }),

                    // Service Details Table
                    new Paragraph({
                        text: "SERVICE DETAILS",
                        heading: HeadingLevel.HEADING_2,
                        spacing: { before: 400, after: 100 }
                    }),

                    new Table({
                        width: { size: 100, type: WidthType.PERCENTAGE },
                        rows: [
                            new TableRow({
                                children: [
                                    new TableCell({
                                        children: [new Paragraph({ text: "Service Type:", bold: true })],
                                        width: { size: 20, type: WidthType.PERCENTAGE },
                                        shading: { fill: "E7E6E6" }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph(formData.serviceType)],
                                        width: { size: 30, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Preferred Date:", bold: true })],
                                        width: { size: 20, type: WidthType.PERCENTAGE },
                                        shading: { fill: "E7E6E6" }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph(formData.preferredDate)],
                                        width: { size: 30, type: WidthType.PERCENTAGE }
                                    })
                                ]
                            })
                        ]
                    }),

                    // Items Header
                    new Paragraph({
                        text: "ITEMS & SPECIFICATIONS",
                        heading: HeadingLevel.HEADING_2,
                        spacing: { before: 400, after: 200 }
                    }),

                    // Items Table - Spreadsheet Style
                    new Table({
                        width: { size: 100, type: WidthType.PERCENTAGE },
                        rows: [
                            // Header Row
                            new TableRow({
                                children: [
                                    new TableCell({
                                        children: [new Paragraph({ text: "#", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 3, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Qty", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 4, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Width", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 5, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Height", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 5, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Factor", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 5, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Frame", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 8, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Glass Type", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 8, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Glass Make-up", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 10, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Wall Type", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 8, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Color", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 8, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Grid", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 6, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Room", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 8, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Config Ext.", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 10, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Price", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 7, type: WidthType.PERCENTAGE }
                                    })
                                ]
                            }),
                            // Data Rows
                            ...formData.entries.map((entry, i) => 
                                new TableRow({
                                    children: [
                                        new TableCell({
                                            children: [new Paragraph((i + 1).toString())],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.qty)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.width)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.height)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.factor)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.frame)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.glassType)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.glassMakeup)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.wallType)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.color)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.grid)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.room)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.configExterior)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph({ text: `$${entry.price}`, bold: true })],
                                            shading: { fill: i % 2 === 0 ? "D6EAF8" : "AED6F1" }
                                        })
                                    ]
                                })
                            )
                        ]
                    }),

                    // Totals Section
                    new Paragraph({
                        text: "",
                        spacing: { before: 300 }
                    }),

                    new Table({
                        width: { size: 100, type: WidthType.PERCENTAGE },
                        rows: [
                            new TableRow({
                                children: [
                                    new TableCell({
                                        children: [new Paragraph({ text: "Subtotal:", bold: true, alignment: AlignmentType.RIGHT })],
                                        width: { size: 85, type: WidthType.PERCENTAGE },
                                        shading: { fill: "F2F2F2" }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: `$${formData.subtotal}`, bold: true })],
                                        width: { size: 15, type: WidthType.PERCENTAGE },
                                        shading: { fill: "F2F2F2" }
                                    })
                                ]
                            }),
                            new TableRow({
                                children: [
                                    new TableCell({
                                        children: [new Paragraph({ text: "Tax (10.25%):", bold: true, alignment: AlignmentType.RIGHT })],
                                        shading: { fill: "FFFFFF" }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: `$${formData.tax}`, bold: true })],
                                        shading: { fill: "FFFFFF" }
                                    })
                                ]
                            }),
                            new TableRow({
                                children: [
                                    new TableCell({
                                        children: [new Paragraph({ text: "TOTAL:", bold: true, alignment: AlignmentType.RIGHT })],
                                        shading: { fill: "4472C4" }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: `$${formData.total}`, bold: true })],
                                        shading: { fill: "B4C7E7" }
                                    })
                                ]
                            })
                        ]
                    }),

                    // Notes Section
                    new Paragraph({
                        text: "Special Notes",
                        heading: HeadingLevel.HEADING_3,
                        spacing: { before: 300, after: 100 }
                    }),

                    new Table({
                        width: { size: 100, type: WidthType.PERCENTAGE },
                        rows: [
                            new TableRow({
                                children: [
                                    new TableCell({
                                        children: [new Paragraph({ text: "Item #", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 10, type: WidthType.PERCENTAGE }
                                    }),
                                    new TableCell({
                                        children: [new Paragraph({ text: "Notes", bold: true })],
                                        shading: { fill: "4472C4" },
                                        width: { size: 90, type: WidthType.PERCENTAGE }
                                    })
                                ]
                            }),
                            ...formData.entries.map((entry, i) => 
                                new TableRow({
                                    children: [
                                        new TableCell({
                                            children: [new Paragraph((i + 1).toString())],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        }),
                                        new TableCell({
                                            children: [new Paragraph(entry.notes)],
                                            shading: { fill: i % 2 === 0 ? "FFFFFF" : "F2F2F2" }
                                        })
                                    ]
                                })
                            )
                        ]
                    }),

                    // TERMS AND CONDITIONS SECTION
                    new Paragraph({
                        text: "",
                        spacing: { before: 400 }
                    }),

                    new Paragraph({
                        children: [
                            new TextRun({
                                text: "You will be receiving a phone call from 310-203-4880 to schedule your install.",
                                bold: true,
                                size: 18
                            })
                        ],
                        spacing: { after: 100 }
                    }),

                    new Paragraph({
                        children: [
                            new TextRun({ text: "Notes: ", bold: true, size: 16 }),
                            new TextRun({ text: "Includes Window(s) and/or Door(s), screen, installation, lifetime warranty, and haul away.", size: 16 })
                        ],
                        spacing: { after: 100 }
                    }),

                    new Paragraph({
                        children: [
                            new TextRun({ text: "Payment Terms: ", bold: true, size: 16 }),
                            new TextRun({ text: "*10% Deposit or $1000 whichever is less, 40% or the balance to complete 50% at the time of final measurements. Final 50% On Delivery", size: 16 })
                        ],
                        spacing: { after: 100 }
                    }),

                    new Paragraph({
                        text: "Quote valid for 30 days from date here of. Customer is responsible to verify design and configurations. All orders are final and non-refundable. Customer is responsible for confirmation to local city building codes. Any window coverings, drapes, blinds, shutters, etc... must be removed by the customer prior to install. Bear Windows will not be responsible for any of the window coverings being damaged during removal or installation. All furniture or breakables must be moved 3ft away from the window(s) or door(s) by the customer(s). Bear windows will not be responsible for any furniture that is damaged while being moved by our workers. Alarm connections must be reconnected by the customer. Drawings, plans or permits may incur an additional fee.",
                        spacing: { after: 200 }
                    }),

                    new Paragraph({
                        children: [
                            new TextRun({ text: "INITIALS: __________", bold: true })
                        ],
                        spacing: { after: 100 }
                    }),

                    new Paragraph({ text: "Down Payment of  $__________", spacing: { after: 50 } }),
                    new Paragraph({ text: "Second Payment of  $__________", spacing: { after: 50 } }),
                    new Paragraph({ text: "Final Payment of  $__________", spacing: { after: 100 } }),

                    new Paragraph({ text: "CREDIT CARD # ___________  ________________  ____________  ________", spacing: { after: 100 } }),
                    new Paragraph({ text: "Financing_______ Visa_____ Master Card______ Discover______ American Express______ Expiration Date____/20____ 3 or 4 Digit Code______", spacing: { after: 100 } }),

                    new Paragraph({
                        text: "(Signature)__________________________________ Date:______/_______/20______",
                        spacing: { after: 50 }
                    }),

                    new Paragraph({
                        text: "By Signing above, I authorize Bear Windows Inc. to process my credit card before installation of window(s):",
                        spacing: { after: 200 }
                    }),

                    new Paragraph({
                        children: [
                            new TextRun({ text: "3 or 5 Day Cancelation Clause:", bold: true, underline: { type: UnderlineType.SINGLE } })
                        ],
                        spacing: { after: 100 }
                    }),

                    new Paragraph({
                        text: "Date of Transaction: ____/____/____ You, the buyer, have the right to cancel this contract within three business days or 5 days if your are over the age of 65. You may cancel by emailing, mailing, faxing, or delivering a written notice to Bear Windows at 2501 Strozier Ave, South El Monte, CA 91733 by midnight of the third day after you received a signed and dated copy of the contract that includes this notice (fifth day if you are over 65). Include your name, your address, and the date you received the signed copy of the contract.",
                        spacing: { after: 200 }
                    }),

                    new Paragraph({
                        children: [
                            new TextRun({ text: "Waiver of Cancelation Clause:", bold: true, underline: { type: UnderlineType.SINGLE } })
                        ],
                        spacing: { after: 50 }
                    }),

                    new Paragraph({
                        text: "By Signing here you acknowledge that you are waiving your 3 or 5 day Cancelation Clause.",
                        spacing: { after: 100 }
                    }),

                    new Paragraph({
                        text: "Printed Name____________________________________________ Signature______________________________________ Date___________________________",
                        spacing: { after: 200 }
                    }),

                    new Paragraph({
                        children: [
                            new TextRun({ text: "Mechanics Lien Warning: ", bold: true })
                        ],
                        spacing: { after: 50 }
                    }),

                    new Paragraph({
                        text: "Anyone who helps improve your property, but who is not paid in full may record what is called a mechanics lien on your property. A mechanics lien is a claim, like a mortgage or home equity loan, made against your property and recorded with the county recorder. If a court finds the lien valid, you could be forced to pay twice or have a county officer sell your home to pay the lien.",
                        spacing: { after: 100 }
                    }),

                    new Paragraph({
                        text: "By signing below, I am acknowledging that I am owner of said property and take full responsibility for amount of this contract I understand that if I use a Credit Card, I have to pay in full when my window(s) is (are) installed. I agree pay a $50 fee to Bear Windows Inc. plus the amount owed if my check is returned or charges are disputed. I have Read, Acknowledged and Agree with the \"Terms and Conditions\" in which its presented and Agree with the terms of this Contract and Warranty.",
                        spacing: { after: 100 }
                    }),

                    new Paragraph({
                        text: "Print Name______________________Signature__________________________Date_____________",
                        spacing: { after: 50 }
                    }),

                    new Paragraph({
                        text: "Print Name______________________Signature__________________________Date_____________",
                        spacing: { after: 100 }
                    }),

                    new Paragraph({
                        children: [
                            new TextRun({
                                text: "WWW.BEARWINDOWSINC.COM",
                                bold: true
                            })
                        ],
                        alignment: AlignmentType.CENTER
                    })
                ]
            }]
        });

        const blob = await Packer.toBlob(doc);
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `Bear_Contract_${formData.soldTo.replace(/\s+/g, '_')}.docx`;
        a.click();
        URL.revokeObjectURL(url);
    } catch (error) {
        alert('Error generating Word document: ' + error.message);
        console.error(error);
    }
    hideLoading();
}
        async function downloadPDF() {
    showLoading();
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('landscape');

        const pageWidth = doc.internal.pageSize.width;
        const pageHeight = doc.internal.pageSize.height;
        const margin = 10;
        let yPos = 20;

        function checkPageBreak(neededSpace = 10) {
            if (yPos + neededSpace > pageHeight - margin) {
                doc.addPage();
                yPos = 20;
                return true;
            }
            return false;
        }
        async function convertWebpToPng(url) {
        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.src = url;
        await img.decode();

        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;

        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0);

        return canvas.toDataURL("image/png");
    }


        // Header
        doc.setFillColor(68, 114, 196);
        doc.rect(0, 0, pageWidth, 20, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(18);
        doc.setFont(undefined, 'bold');
        doc.text("BEAR INTAKE CONTRACT", pageWidth / 2, 12, { align: 'center' });
        
        doc.setTextColor(0, 0, 0);
        yPos = 30;
        //Image 
const imageUrl = "https://images.leadconnectorhq.com/image/f_webp/q_85/r_1000/u_https://storage.googleapis.com/highlevel-backend.appspot.com/location/xzNra69OGYHaxmdDlDMn/form/eDvPanXWhbtHSvXrKdqz/b7d8cff1-2f99-4651-9dd9-f269926c08bb.webp";

    const pngBase64 = await convertWebpToPng(imageUrl);
    doc.addImage(pngBase64, "PNG", margin, yPos, 35, 20);

    yPos += 20;


//Bumper


        // Date
        doc.setFontSize(9);
        doc.setFont(undefined, 'normal');
        doc.text(`Date: ${new Date().toLocaleDateString()}`, pageWidth - margin, yPos, { align: 'right' });
        yPos += 10;

        // CLIENT INFORMATION Section
        doc.setFillColor(68, 114, 196);
        doc.rect(margin, yPos, pageWidth - (margin * 2), 7, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.text("CLIENT INFORMATION", margin + 2, yPos + 5);
        doc.setTextColor(0, 0, 0);
        yPos += 8;

        // Client info in compact 2-column format
        const rowHeight = 6;
        const col1Width = (pageWidth - margin * 2) / 2;

        doc.setFillColor(245, 245, 245);
        doc.rect(margin, yPos, pageWidth - (margin * 2), rowHeight, 'F');
        doc.rect(margin, yPos, pageWidth - (margin * 2), rowHeight);
        
        doc.setFontSize(8);
        doc.setFont(undefined, 'bold');
        doc.text("Sold To:", margin + 2, yPos + 4);
        doc.setFont(undefined, 'normal');
        doc.text(formData.soldTo, margin + 20, yPos + 4);
        
        doc.setFont(undefined, 'bold');
        doc.text("Phone:", margin + col1Width + 2, yPos + 4);
        doc.setFont(undefined, 'normal');
        doc.text(formData.phone, margin + col1Width + 18, yPos + 4);
        yPos += rowHeight;

        doc.rect(margin, yPos, pageWidth - (margin * 2), rowHeight);
        doc.setFont(undefined, 'bold');
        doc.text("Email:", margin + 2, yPos + 4);
        doc.setFont(undefined, 'normal');
        doc.text(formData.email, margin + 20, yPos + 4);
        
        doc.setFont(undefined, 'bold');
        doc.text("Job Site:", margin + col1Width + 2, yPos + 4);
        doc.setFont(undefined, 'normal');
        doc.text(formData.jobSite, margin + col1Width + 18, yPos + 4);
        yPos += rowHeight + 5;

        // SERVICE DETAILS Section
        doc.setFillColor(68, 114, 196);
        doc.rect(margin, yPos, pageWidth - (margin * 2), 7, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.text("SERVICE DETAILS", margin + 2, yPos + 5);
        doc.setTextColor(0, 0, 0);
        yPos += 8;

        doc.setFillColor(245, 245, 245);
        doc.rect(margin, yPos, pageWidth - (margin * 2), rowHeight, 'F');
        doc.rect(margin, yPos, pageWidth - (margin * 2), rowHeight);
        
        doc.setFontSize(8);
        doc.setFont(undefined, 'bold');
        doc.text("Service Type:", margin + 2, yPos + 4);
        doc.setFont(undefined, 'normal');
        doc.text(formData.serviceType, margin + 28, yPos + 4);
        
        doc.setFont(undefined, 'bold');
        doc.text("Preferred Date:", margin + col1Width + 2, yPos + 4);
        doc.setFont(undefined, 'normal');
        doc.text(formData.preferredDate, margin + col1Width + 30, yPos + 4);
        yPos += rowHeight + 8;

        // ITEMS TABLE - Spreadsheet Style
        doc.setFillColor(68, 114, 196);
        doc.rect(margin, yPos, pageWidth - (margin * 2), 7, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(11);
        doc.setFont(undefined, 'bold');
        doc.text("ITEMS & SPECIFICATIONS", margin + 2, yPos + 5);
        doc.setTextColor(0, 0, 0);
        yPos += 8;

        // Table headers
        const tableWidth = pageWidth - (margin * 2);
        const colWidths = [10, 12, 18, 18, 16, 22, 25, 30, 24, 24, 18, 20, 30, 20];
        const colHeaders = ["#", "Qty", "Width", "Height", "Factor", "Frame", "Glass Type", "Glass Make-up", "Wall Type", "Color", "Grid", "Room", "Config Ext.", "Price"];
        
        let xPos = margin;
        doc.setFillColor(68, 114, 196);
        doc.rect(margin, yPos, tableWidth, 6, 'F');
        
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(7);
        doc.setFont(undefined, 'bold');
        
        colHeaders.forEach((header, i) => {
            doc.text(header, xPos + 1, yPos + 4);
            xPos += colWidths[i];
        });
        
        doc.setTextColor(0, 0, 0);
        yPos += 6;

        // Table data rows
        formData.entries.forEach((entry, idx) => {
            checkPageBreak(8);
            
            xPos = margin;
            
            // Alternating row colors
            if (idx % 2 === 0) {
                doc.setFillColor(255, 255, 255);
            } else {
                doc.setFillColor(242, 242, 242);
            }
            doc.rect(margin, yPos, tableWidth, 6, 'F');
            
            // Draw cell borders
            doc.setDrawColor(200, 200, 200);
            let currentX = margin;
            colWidths.forEach(width => {
                doc.line(currentX, yPos, currentX, yPos + 6);
                currentX += width;
            });
            doc.line(currentX, yPos, currentX, yPos + 6);
            doc.rect(margin, yPos, tableWidth, 6);
            
            doc.setFontSize(6);
            doc.setFont(undefined, 'normal');
            
            const rowData = [
                (idx + 1).toString(),
                entry.qty,
                entry.width,
                entry.height,
                entry.factor,
                entry.frame,
                entry.glassType,
                entry.glassMakeup,
                entry.wallType,
                entry.color,
                entry.grid,
                entry.room,
                entry.configExterior,
                `$${entry.price}`
            ];
            
            rowData.forEach((data, i) => {
                let displayText = data.toString();
                if (doc.getTextWidth(displayText) > colWidths[i] - 2) {
                    while (doc.getTextWidth(displayText + '...') > colWidths[i] - 2 && displayText.length > 0) {
                        displayText = displayText.slice(0, -1);
                    }
                    displayText += '...';
                }
                
                if (i === 13) {
                    doc.setFont(undefined, 'bold');
                    doc.setFillColor(214, 234, 248);
                    doc.rect(xPos, yPos, colWidths[i], 6, 'F');
                }
                
                doc.text(displayText, xPos + 1, yPos + 4);
                
                if (i === 13) {
                    doc.setFont(undefined, 'normal');
                }
                
                xPos += colWidths[i];
            });
            
            yPos += 6;
        });

        yPos += 8;
        checkPageBreak(30);

        // Totals Section
        const totalsX = pageWidth - margin - 70;
        const totalsWidth = 70;

        doc.setFillColor(242, 242, 242);
        doc.rect(totalsX, yPos, totalsWidth, 6, 'F');
        doc.rect(totalsX, yPos, totalsWidth, 6);
        doc.setFontSize(9);
        doc.setFont(undefined, 'bold');
        doc.text("Subtotal:", totalsX + 2, yPos + 4);
        doc.text(`$${formData.subtotal}`, totalsX + totalsWidth - 2, yPos + 4, { align: 'right' });
        yPos += 6;

        doc.rect(totalsX, yPos, totalsWidth, 6);
        doc.text("Tax (10.25%):", totalsX + 2, yPos + 4);
        doc.text(`$${formData.tax}`, totalsX + totalsWidth - 2, yPos + 4, { align: 'right' });
        yPos += 6;

        doc.setFillColor(68, 114, 196);
        doc.rect(totalsX, yPos, totalsWidth, 7, 'F');
        doc.setFontSize(10);
        doc.setTextColor(255, 255, 255);
        doc.text("TOTAL:", totalsX + 2, yPos + 5);
        doc.text(`$${formData.total}`, totalsX + totalsWidth - 2, yPos + 5, { align: 'right' });
        doc.setTextColor(0, 0, 0);
        yPos += 10;

        checkPageBreak(20);

        // Special Notes Section
        doc.setFillColor(68, 114, 196);
        doc.rect(margin, yPos, pageWidth - (margin * 2), 6, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(10);
        doc.setFont(undefined, 'bold');
        doc.text("SPECIAL NOTES", margin + 2, yPos + 4);
        doc.setTextColor(0, 0, 0);
        yPos += 7;

        formData.entries.forEach((entry, idx) => {
            checkPageBreak(10);
            
            doc.setFillColor(idx % 2 === 0 ? 255 : 245, idx % 2 === 0 ? 255 : 245, idx % 2 === 0 ? 255 : 245);
            const notesHeight = 8;
            doc.rect(margin, yPos, tableWidth, notesHeight, 'F');
            doc.rect(margin, yPos, tableWidth, notesHeight);
            
            doc.setFontSize(7);
            doc.setFont(undefined, 'bold');
            doc.text(`Item ${idx + 1}:`, margin + 2, yPos + 5);
            
            doc.setFont(undefined, 'normal');
            const notesText = doc.splitTextToSize(entry.notes, tableWidth - 30);
            doc.text(notesText, margin + 20, yPos + 5);
            
            yPos += notesHeight;
        });

        // TERMS AND CONDITIONS - START NEW PAGE
        doc.addPage();
        yPos = 20;

        doc.setFontSize(9);
        doc.setFont(undefined, 'bold');
        doc.text("You will be receiving a phone call from 310-203-4880 to schedule your install.", margin, yPos);
        yPos += 6;

        doc.setFont(undefined, 'bold');
        doc.text("Notes:", margin, yPos);
        doc.setFont(undefined, 'normal');
        const notesText = doc.splitTextToSize("Includes Window(s) and/or Door(s), screen, installation, lifetime warranty, and haul away.", pageWidth - margin * 2);
        doc.text(notesText, margin + 12, yPos);
        yPos += 6;

        doc.setFont(undefined, 'bold');
        doc.text("Payment Terms:", margin, yPos);
        doc.setFont(undefined, 'normal');
        const paymentText = doc.splitTextToSize("*10% Deposit or $1000 whichever is less, 40% or the balance to complete 50% at the time of final measurements. Final 50% On Delivery", pageWidth - margin * 2);
        doc.text(paymentText, margin + 30, yPos);
        yPos += 10;

        doc.setFontSize(7);
        const termsText = doc.splitTextToSize("Quote valid for 30 days from date here of. Customer is responsible to verify design and configurations. All orders are final and non-refundable. Customer is responsible for confirmation to local city building codes. Any window coverings, drapes, blinds, shutters, etc... must be removed by the customer prior to install. Bear Windows will not be responsible for any of the window coverings being damaged during removal or installation. All furniture or breakables must be moved 3ft away from the window(s) or door(s) by the customer(s). Bear windows will not be responsible for any furniture that is damaged while being moved by our workers. Alarm connections must be reconnected by the customer. Drawings, plans or permits may incur an additional fee.", pageWidth - margin * 2);
        doc.text(termsText, margin, yPos);
        yPos += 25;

        doc.setFontSize(8);
        doc.setFont(undefined, 'bold');
        doc.text("INITIALS: __________", margin, yPos);
        yPos += 8;

        doc.setFont(undefined, 'normal');
        doc.text("Down Payment of  $__________", margin, yPos);
        yPos += 5;
        doc.text("Second Payment of  $__________", margin, yPos);
        yPos += 5;
        doc.text("Final Payment of  $__________", margin, yPos);
        yPos += 8;

        doc.text("CREDIT CARD # ___________  ________________  ____________  ________", margin, yPos);
        yPos += 5;
        doc.text("Financing_______ Visa_____ Master Card______ Discover______ American Express______ Expiration Date____/20____ 3 or 4 Digit Code______", margin, yPos);
        yPos += 8;

        doc.text("(Signature)__________________________________ Date:______/_______/20______", margin, yPos);
        yPos += 5;
        doc.text("By Signing above, I authorize Bear Windows Inc. to process my credit card before installation of window(s):", margin, yPos);
        yPos += 10;

        doc.setFont(undefined, 'bold');
        doc.text("3 or 5 Day Cancelation Clause:", margin, yPos);
        yPos += 5;

        doc.setFontSize(7);
        doc.setFont(undefined, 'normal');
        const cancelText = doc.splitTextToSize("Date of Transaction: ____/____/____ You, the buyer, have the right to cancel this contract within three business days or 5 days if your are over the age of 65. You may cancel by emailing, mailing, faxing, or delivering a written notice to Bear Windows at 2501 Strozier Ave, South El Monte, CA 91733 by midnight of the third day after you received a signed and dated copy of the contract that includes this notice (fifth day if you are over 65). Include your name, your address, and the date you received the signed copy of the contract.", pageWidth - margin * 2);
        doc.text(cancelText, margin, yPos);
        yPos += 15;

        doc.setFontSize(8);
        doc.setFont(undefined, 'bold');
        doc.text("Waiver of Cancelation Clause:", margin, yPos);
        yPos += 5;
        doc.setFont(undefined, 'normal');
        doc.text("By Signing here you acknowledge that you are waiving your 3 or 5 day Cancelation Clause.", margin, yPos);
        yPos += 5;
        doc.text("Printed Name____________________________________________ Signature______________________________________ Date___________________________", margin, yPos);
        yPos += 10;

        doc.setFont(undefined, 'bold');
        doc.text("Mechanics Lien Warning:", margin, yPos);
        yPos += 5;

        doc.setFontSize(7);
        doc.setFont(undefined, 'normal');
        const lienText = doc.splitTextToSize("Anyone who helps improve your property, but who is not paid in full may record what is called a mechanics lien on your property. A mechanics lien is a claim, like a mortgage or home equity loan, made against your property and recorded with the county recorder. If a court finds the lien valid, you could be forced to pay twice or have a county officer sell your home to pay the lien.", pageWidth - margin * 2);
        doc.text(lienText, margin, yPos);
        yPos += 15;

        const agreementText = doc.splitTextToSize("By signing below, I am acknowledging that I am owner of said property and take full responsibility for amount of this contract I understand that if I use a Credit Card, I have to pay in full when my window(s) is (are) installed. I agree pay a $50 fee to Bear Windows Inc. plus the amount owed if my check is returned or charges are disputed. I have Read, Acknowledged and Agree with the \"Terms and Conditions\" in which its presented and Agree with the terms of this Contract and Warranty.", pageWidth - margin * 2);
        doc.text(agreementText, margin, yPos);
        yPos += 15;

        doc.setFontSize(8);
        doc.text("Print Name______________________Signature__________________________Date_____________", margin, yPos);
        yPos += 5;
        doc.text("Print Name______________________Signature__________________________Date_____________", margin, yPos);
        yPos += 10;

        doc.setFont(undefined, 'bold');
        doc.setFontSize(10);
        doc.text("WWW.BEARWINDOWSINC.COM", pageWidth / 2, yPos, { align: 'center' });

        doc.save(`Bear_Contract_${formData.soldTo.replace(/\s+/g, '_')}.pdf`);
    } catch (error) {
        alert('Error generating PDF: ' + error.message);
        console.error(error);
    }
    hideLoading();
}
        async function downloadBoth() {
            showLoading();
            await downloadWord();
            await new Promise(resolve => setTimeout(resolve, 500)); // Small delay
            await downloadPDF();
            hideLoading();
        }
    </script>
</body>
</html>